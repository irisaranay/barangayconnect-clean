"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6165],{1815:(I,q,l)=>{l.d(q,{f:()=>F});var d=l(467),f=l(1471),a=l(8728),e=l(3622),_=l(8880),b=l(8492);let F=(()=>{class P{constructor(s,i,c){this.sqlite=s,this.platform=i,this.storage=c,this.dbInstance=null,this.initDatabase()}initDatabase(){var s=this;return(0,d.A)(function*(){try{if(!s.platform.is("hybrid"))return void console.warn("Not running on hybrid platform \u2014 SQLite is not available.");const i=yield s.sqlite.create({name:"barangayconnect.db",location:"default"});s.dbInstance=i,yield i.executeSql("\n        CREATE TABLE IF NOT EXISTS users (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          firstName TEXT,\n          middleName TEXT,\n          lastName TEXT,\n          dob TEXT,\n          gender TEXT,\n          civilStatus TEXT,\n          contact TEXT UNIQUE,\n          purok TEXT,\n          barangay TEXT,\n          city TEXT,\n          province TEXT,\n          postalCode TEXT,\n          password TEXT,\n          photo TEXT,\n          role TEXT\n        )\n      ",[])}catch(i){console.error("SQLite init error:",i)}})()}saveOfflineRegistration(s){var i=this;return(0,d.A)(function*(){if(!i.dbInstance)return void console.error("Database is not initialized");const c=f.SHA256(s.password).toString(),p=[s.firstName,s.middleName,s.lastName,s.dob,s.gender,s.civilStatus,s.contact,s.purok,s.barangay,s.city,s.province,s.postalCode,c,s.photo,s.role||"resident"];console.log("\u{1f4e5} Attempting to insert into SQLite:",p);try{const g=yield i.dbInstance.executeSql("\n      INSERT INTO users (\n        firstName, middleName, lastName, dob, gender, civilStatus, contact, purok,\n        barangay, city, province, postalCode, password, photo, role\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ",p);console.log("\u2705 Insert result:",g),1===g.rowsAffected?console.log("\u2705 User inserted successfully."):console.warn("\u26a0\ufe0f Insert did not affect any rows.")}catch(g){console.error("\u274c Insert error:",g.message||g)}})()}getAllRegistrations(){var s=this;return(0,d.A)(function*(){if(!s.dbInstance)return console.warn("getAllRegistrations: Database not available."),[];const i=yield s.dbInstance.executeSql("SELECT * FROM users",[]),c=[];for(let u=0;u<i.rows.length;u++)c.push(i.rows.item(u));return c})()}isDuplicateContact(s){var i=this;return(0,d.A)(function*(){return i.dbInstance?(yield i.dbInstance.executeSql("SELECT * FROM users WHERE contact = ?",[s])).rows.length>0:(console.warn("isDuplicateContact: Database not available."),!1)})()}isDuplicateName(s,i,c){var u=this;return(0,d.A)(function*(){return u.dbInstance?(yield u.dbInstance.executeSql("SELECT * FROM users WHERE lower(firstName) = ? AND lower(middleName) = ? AND lower(lastName) = ?",[s.toLowerCase(),i.toLowerCase(),c.toLowerCase()])).rows.length>0:(console.warn("isDuplicateName: Database not available."),!1)})()}updateUser(s){var i=this;return(0,d.A)(function*(){if(!i.dbInstance)return void console.warn("updateUser: Database not available.");const u=[s.firstName,s.middleName,s.lastName,s.dob,s.gender,s.civilStatus,s.contact,s.purok,s.barangay,s.city,s.province,s.postalCode,s.password,s.photo,s.id];yield i.dbInstance.executeSql("\n      UPDATE users SET\n        firstName = ?, middleName = ?, lastName = ?, dob = ?, gender = ?, civilStatus = ?,\n        contact = ?, purok = ?, barangay = ?, city = ?, province = ?, postalCode = ?,\n        password = ?, photo = ?\n      WHERE id = ?\n    ",u)})()}checkLogin(s,i){var c=this;return(0,d.A)(function*(){const u=f.SHA256(i).toString();if(c.dbInstance)try{const R=yield c.dbInstance.executeSql("SELECT * FROM users WHERE contact = ? AND password = ?",[s,u]);if(R.rows.length>0)return R.rows.item(0)}catch(R){console.error("SQLite checkLogin error:",R)}else console.warn("SQLite not available. Using fallback storage.");const p=yield c.storage.get("secretary"),g=yield c.storage.get("captain");return p&&p.phone===s&&p.password===u?{...p,role:"secretary"}:g&&g.phone===s&&g.password===u?{...g,role:"captain"}:null})()}setCurrentUser(s){this.currentUser=s}getCurrentUser(){return this.currentUser}clearAll(){var s=this;return(0,d.A)(function*(){s.dbInstance?yield s.dbInstance.executeSql("DELETE FROM users",[]):console.warn("clearAll: Database not available.")})()}static#e=this.\u0275fac=function(i){return new(i||P)(a.KVO(e.j),a.KVO(_.OD),a.KVO(b.w))};static#t=this.\u0275prov=a.jDH({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})()},6165:(I,q,l)=>{l.r(q),l.d(q,{RequestLogPage:()=>R});var d=l(467),f=l(2200),m=l(4341),a=l(6908),e=l(3664),_=l(8728),b=l(7527),F=l(1815);function P(r,h){if(1&r){const t=e.RV6();e.j41(0,"ion-button",17),e.bIt("click",function(){_.eBV(t);const o=e.XpG().$implicit,E=e.XpG();return _.Njj(E.cancelRequest(o))}),e.EFF(1," Cancel Request "),e.k0s()}}function v(r,h){if(1&r){const t=e.RV6();e.j41(0,"ion-button",18),e.bIt("click",function(){_.eBV(t);const o=e.XpG().$implicit,E=e.XpG();return _.Njj(E.viewDetails(o))}),e.EFF(1," View Details "),e.k0s()}}function s(r,h){if(1&r){const t=e.RV6();e.j41(0,"ion-button",19),e.bIt("click",function(){_.eBV(t);const o=e.XpG().$implicit,E=e.XpG();return _.Njj(E.deleteRequest(o))}),e.EFF(1," Delete "),e.k0s()}}function i(r,h){if(1&r&&(e.j41(0,"ion-row")(1,"ion-col",7),e.EFF(2),e.k0s(),e.j41(3,"ion-col",8),e.EFF(4),e.k0s(),e.j41(5,"ion-col",8),e.EFF(6),e.k0s(),e.j41(7,"ion-col",9)(8,"ion-text",13),e.EFF(9),e.k0s()(),e.j41(10,"ion-col",8),e.DNE(11,P,2,0,"ion-button",14)(12,v,2,0,"ion-button",15)(13,s,2,0,"ion-button",16),e.k0s()()),2&r){const t=h.$implicit,n=h.index,o=e.XpG();e.R7$(2),e.JRh(n+1+(o.currentPage-1)*o.itemsPerPage),e.R7$(2),e.JRh(t.documentType),e.R7$(2),e.JRh(t.timestamp),e.R7$(2),e.Y8G("color",o.getStatusColor(t.status)),e.R7$(),e.SpI(" ",t.status," "),e.R7$(2),e.Y8G("ngIf","Pending"===t.status),e.R7$(),e.Y8G("ngIf","Pending"!==t.status),e.R7$(),e.Y8G("ngIf","Cancelled"===t.status)}}function c(r,h){if(1&r){const t=e.RV6();e.j41(0,"ion-row",20)(1,"ion-button",21),e.bIt("click",function(){_.eBV(t);const o=e.XpG();return _.Njj(o.prevPage())}),e.EFF(2,"Prev"),e.k0s(),e.j41(3,"span"),e.EFF(4),e.k0s(),e.j41(5,"ion-button",21),e.bIt("click",function(){_.eBV(t);const o=e.XpG();return _.Njj(o.nextPage())}),e.EFF(6,"Next"),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(),e.Y8G("disabled",1===t.currentPage),e.R7$(3),e.Lme("Page ",t.currentPage," of ",t.totalPages),e.R7$(),e.Y8G("disabled",t.currentPage===t.totalPages)}}function u(r,h){if(1&r&&(e.j41(0,"p")(1,"strong"),e.EFF(2,"Remarks:"),e.k0s(),e.EFF(3),e.k0s()),2&r){const t=e.XpG(2);e.R7$(3),e.SpI(" ",(null==t.selectedRequest?null:t.selectedRequest.notes)||"No remarks"," ")}}function p(r,h){if(1&r&&(e.j41(0,"div")(1,"strong"),e.EFF(2,"Photo:"),e.k0s(),e.nrm(3,"img",25),e.k0s()),2&r){const t=e.XpG(2);e.R7$(3),e.Y8G("src",t.selectedRequest.photo,e.B4B)}}function g(r,h){if(1&r){const t=e.RV6();e.j41(0,"ion-modal")(1,"ion-header")(2,"ion-toolbar")(3,"ion-title"),e.EFF(4,"Request Details"),e.k0s(),e.j41(5,"ion-buttons",22)(6,"ion-button",23),e.bIt("click",function(){_.eBV(t);const o=e.XpG();return _.Njj(o.closeModal())}),e.EFF(7,"Close"),e.k0s()()()(),e.j41(8,"ion-content",24)(9,"ion-card")(10,"ion-card-header")(11,"ion-card-title"),e.EFF(12),e.k0s(),e.j41(13,"ion-card-subtitle"),e.EFF(14),e.k0s()(),e.j41(15,"ion-card-content")(16,"p")(17,"strong"),e.EFF(18,"Purpose:"),e.k0s(),e.EFF(19),e.k0s(),e.j41(20,"p")(21,"strong"),e.EFF(22,"Copies:"),e.k0s(),e.EFF(23),e.k0s(),e.j41(24,"p")(25,"strong"),e.EFF(26,"Requested On:"),e.k0s(),e.EFF(27),e.k0s(),e.DNE(28,u,4,1,"p",12)(29,p,4,1,"div",12),e.k0s()()()()}if(2&r){const t=e.XpG();e.R7$(12),e.JRh(null==t.selectedRequest?null:t.selectedRequest.documentType),e.R7$(2),e.JRh(null==t.selectedRequest?null:t.selectedRequest.status),e.R7$(5),e.SpI(" ",null==t.selectedRequest?null:t.selectedRequest.purpose),e.R7$(4),e.SpI(" ",null==t.selectedRequest?null:t.selectedRequest.copies),e.R7$(4),e.SpI(" ",null==t.selectedRequest?null:t.selectedRequest.timestamp),e.R7$(),e.Y8G("ngIf","Rejected"===(null==t.selectedRequest?null:t.selectedRequest.status)),e.R7$(),e.Y8G("ngIf",null==t.selectedRequest?null:t.selectedRequest.photo)}}let R=(()=>{class r{constructor(t,n){this.documentRequestService=t,this.registrationService=n,this.itemsPerPage=5,this.currentPage=1,this.totalPages=1,this.searchTerm="",this.requests=[],this.paginatedRequests=[],this.selectedRequest=null,this.showModal=!1}ngOnInit(){this.loadRequests()}ionViewWillEnter(){var t=this;return(0,d.A)(function*(){yield t.loadRequests()})()}loadRequests(){var t=this;return(0,d.A)(function*(){const n=t.registrationService.getCurrentUser();n&&n.contact?(t.requests=yield t.documentRequestService.getRequestsByContact(n.contact),t.filterRequests()):t.requests=[]})()}filterRequests(){const t=this.requests.filter(n=>n.documentType.toLowerCase().includes(this.searchTerm.toLowerCase())||n.purpose.toLowerCase().includes(this.searchTerm.toLowerCase()));this.totalPages=Math.ceil(t.length/this.itemsPerPage)||1,this.currentPage=1,this.paginateRequests(t)}paginateRequests(t=this.requests){const n=(this.currentPage-1)*this.itemsPerPage;this.paginatedRequests=t.slice(n,n+this.itemsPerPage)}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.paginateRequests())}prevPage(){this.currentPage>1&&(this.currentPage--,this.paginateRequests())}viewDetails(t){this.selectedRequest=t,this.showModal=!0}closeModal(){this.showModal=!1}cancelRequest(t){var n=this;return(0,d.A)(function*(){yield n.documentRequestService.cancelRequestById(t.id),n.loadRequests()})()}deleteRequest(t){var n=this;return(0,d.A)(function*(){yield n.documentRequestService.deleteRequestById(t.id),n.loadRequests()})()}getStatusColor(t){switch(t){case"Pending":return"danger";case"Pending-Incomplete":return"success";case"For Pickup":return"dark";case"Cancelled":return"warning";default:return"medium"}}static#e=this.\u0275fac=function(n){return new(n||r)(e.rXU(b.s),e.rXU(F.f))};static#t=this.\u0275cmp=e.VBU({type:r,selectors:[["app-request-log"]],decls:32,vars:10,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[1,"table-controls"],[3,"ngModelChange","change","ngModel"],[3,"value"],["type","text","placeholder","Search...",3,"ngModelChange","input","ngModel"],[1,"table-header"],["size","1"],["size","3"],["size","2"],[4,"ngFor","ngForOf"],["class","pagination-controls",4,"ngIf"],[4,"ngIf"],[3,"color"],["color","danger","size","small",3,"click",4,"ngIf"],["color","primary","size","small",3,"click",4,"ngIf"],["color","medium","size","small",3,"click",4,"ngIf"],["color","danger","size","small",3,"click"],["color","primary","size","small",3,"click"],["color","medium","size","small",3,"click"],[1,"pagination-controls"],["size","small",3,"click","disabled"],["slot","end"],[3,"click"],[1,"ion-padding"],[2,"width","100%","margin-top","10px",3,"src"]],template:function(n,o){1&n&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Request Log"),e.k0s()()(),e.j41(4,"ion-content",1)(5,"div",2)(6,"label"),e.EFF(7," Show "),e.j41(8,"select",3),e.mxI("ngModelChange",function(T){return e.DH7(o.itemsPerPage,T)||(o.itemsPerPage=T),T}),e.bIt("change",function(){return o.paginateRequests()}),e.j41(9,"option",4),e.EFF(10,"5"),e.k0s(),e.j41(11,"option",4),e.EFF(12,"10"),e.k0s(),e.j41(13,"option",4),e.EFF(14,"25"),e.k0s()(),e.EFF(15," entries "),e.k0s(),e.j41(16,"input",5),e.mxI("ngModelChange",function(T){return e.DH7(o.searchTerm,T)||(o.searchTerm=T),T}),e.bIt("input",function(){return o.filterRequests()}),e.k0s()(),e.j41(17,"ion-grid")(18,"ion-row",6)(19,"ion-col",7),e.EFF(20,"#"),e.k0s(),e.j41(21,"ion-col",8),e.EFF(22,"Document"),e.k0s(),e.j41(23,"ion-col",8),e.EFF(24,"Date Requested"),e.k0s(),e.j41(25,"ion-col",9),e.EFF(26,"Status"),e.k0s(),e.j41(27,"ion-col",8),e.EFF(28,"Action"),e.k0s()(),e.DNE(29,i,14,8,"ion-row",10),e.k0s(),e.DNE(30,c,7,4,"ion-row",11),e.k0s(),e.DNE(31,g,30,7,"ion-modal",12)),2&n&&(e.Y8G("translucent",!0),e.R7$(4),e.Y8G("fullscreen",!0),e.R7$(4),e.R50("ngModel",o.itemsPerPage),e.R7$(),e.Y8G("value",5),e.R7$(2),e.Y8G("value",10),e.R7$(2),e.Y8G("value",25),e.R7$(3),e.R50("ngModel",o.searchTerm),e.R7$(13),e.Y8G("ngForOf",o.paginatedRequests),e.R7$(),e.Y8G("ngIf",o.totalPages>1),e.R7$(),e.Y8G("ngIf",o.showModal))},dependencies:[f.MD,f.Sq,f.bT,m.YN,m.xH,m.y7,m.me,m.wz,m.BC,m.vS,a.W9,a.eU,a.BC,a.ai,a.lO,a.ln,a.hU,a.IO,a.Jm,a.Sb,a.b_,a.ME,a.tN,a.HW,a.I9,a.QW],encapsulation:2})}return r})()}}]);