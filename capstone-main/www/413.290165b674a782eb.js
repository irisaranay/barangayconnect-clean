"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[413],{413:(P,h,a)=>{a.r(h),a.d(h,{LoginPage:()=>n});var d=a(467),g=a(9420),u=a(4341),p=a(2200),e=a(3664),m=a(8728),f=a(7134),b=a(1815),_=a(8492);function x(i,c){if(1&i){const t=e.RV6();e.j41(0,"ion-icon",27),e.bIt("click",function(){m.eBV(t);const o=e.XpG();return m.Njj(o.togglePasswordVisibility())}),e.k0s()}if(2&i){const t=e.XpG();e.Y8G("name",t.showPassword?"eye-off":"eye")}}let n=(()=>{class i{constructor(t,r,o,s){this.router=t,this.registrationService=r,this.toastController=o,this.storage=s,this.phone="",this.password="",this.rememberMe=!1,this.showPassword=!1,this.passwordFocused=!1}ngOnInit(){var t=this;return(0,d.A)(function*(){yield t.storage.create();const r=yield t.storage.get("savedPhone");r?.startsWith("+63")&&(t.phone=r.slice(3),t.rememberMe=!0)})()}normalizePhone(t){const r=t.trim().replace(/\D/g,"");return r.startsWith("0")?"+63"+r.slice(1):r.startsWith("9")&&10===r.length?"+63"+r:r}login(){var t=this;return(0,d.A)(function*(){const r=t.phone.trim(),o=r.replace(/\D/g,"");if(/\D/.test(r))return void t.presentToast("\u26a0\ufe0f Phone number must contain numbers only.","warning");if(!r||!t.password)return void t.presentToast("\u26a0\ufe0f Please enter your phone number and password.","warning");if(10!==o.length)return void t.presentToast("\u26a0\ufe0f Phone number must be exactly 10 digits.","warning");const s="+63"+o,l=yield t.registrationService.checkLogin(s,t.password);if(l)switch(t.presentToast("\u2705 Login successful!","success"),t.rememberMe?yield t.storage.set("savedPhone",s):yield t.storage.remove("savedPhone"),t.registrationService.setCurrentUser(l),l.role){case"secretary":t.router.navigate(["/secretary-dashboard"]);break;case"captain":t.router.navigate(["/captain-dashboard"]);break;default:t.router.navigate(["/resident-dashboard"])}else t.presentToast("\u274c Invalid phone number or password.","danger")})()}restrictPhoneInput(t){this.phone=t.target.value.replace(/\D/g,"").slice(0,10)}togglePasswordVisibility(){this.showPassword=!this.showPassword}goToForgotPassword(){this.router.navigate(["/forgot-password"])}goToRegister(){this.router.navigate(["/registration"])}presentToast(t,r){var o=this;return(0,d.A)(function*(){yield(yield o.toastController.create({message:t,duration:2500,color:r,position:"top"})).present()})()}static#e=this.\u0275fac=function(r){return new(r||i)(e.rXU(f.Ix),e.rXU(b.f),e.rXU(g.K_),e.rXU(_.w))};static#n=this.\u0275cmp=e.VBU({type:i,selectors:[["app-login"]],decls:39,vars:6,consts:[[1,"login-content",3,"fullscreen"],[1,"background-overlay"],[1,"login-wrapper"],[1,"login-container","adjusted"],[1,"logo-circle"],["src","assets/logo.jpg","alt","Logo"],[1,"logo-title"],[1,"subtext"],[1,"divider"],[3,"submit"],[1,"phone-container"],["fill","outline","lines","none",1,"phone-box","prefix-box"],[1,"prefix-label"],["fill","outline","lines","none",1,"phone-box","input-box"],["position","floating"],["type","tel","inputmode","numeric","pattern","[0-9]*","maxlength","10","name","phone",3,"ngModelChange","ionInput","ngModel"],["fill","outline",1,"custom-input","center-input"],["name","password","required","",1,"center-text",3,"ngModelChange","focus","blur","type","ngModel"],["slot","end","style","cursor: pointer; font-size: 22px;",3,"name","click",4,"ngIf"],[1,"checkbox-forgot-row"],["lines","none",1,"checkbox-row"],["slot","start","name","rememberMe",1,"custom-checkbox",3,"ngModelChange","ngModel"],[1,"checkbox-label"],[1,"forgot-password",3,"click"],["expand","block","type","submit",1,"ion-margin-top","login-btn"],[1,"ion-text-center","ion-margin-top"],[3,"click"],["slot","end",2,"cursor","pointer","font-size","22px",3,"click","name"]],template:function(r,o){1&r&&(e.j41(0,"ion-content",0),e.nrm(1,"div",1),e.j41(2,"div",2)(3,"div",3)(4,"div",4),e.nrm(5,"img",5),e.k0s(),e.j41(6,"h1",6),e.EFF(7,"BARANGAY CONNECT"),e.k0s(),e.j41(8,"p",7),e.EFF(9,"Where requests meet results"),e.k0s(),e.nrm(10,"div",8),e.j41(11,"form",9),e.bIt("submit",function(){return o.login()}),e.j41(12,"div",10)(13,"ion-item",11)(14,"ion-label",12),e.EFF(15,"(+63)"),e.k0s()(),e.j41(16,"ion-item",13)(17,"ion-label",14),e.EFF(18,"Phone Number"),e.k0s(),e.j41(19,"ion-input",15),e.mxI("ngModelChange",function(l){return e.DH7(o.phone,l)||(o.phone=l),l}),e.bIt("ionInput",function(l){return o.restrictPhoneInput(l)}),e.k0s()()(),e.j41(20,"ion-item",16)(21,"ion-label",14),e.EFF(22,"Password"),e.k0s(),e.j41(23,"ion-input",17),e.mxI("ngModelChange",function(l){return e.DH7(o.password,l)||(o.password=l),l}),e.bIt("focus",function(){return o.passwordFocused=!0})("blur",function(){return o.passwordFocused=!1}),e.k0s(),e.DNE(24,x,1,1,"ion-icon",18),e.k0s(),e.j41(25,"div",19)(26,"ion-item",20)(27,"ion-checkbox",21),e.mxI("ngModelChange",function(l){return e.DH7(o.rememberMe,l)||(o.rememberMe=l),l}),e.k0s(),e.j41(28,"ion-label",22),e.EFF(29,"Remember Me"),e.k0s()(),e.j41(30,"a",23),e.bIt("click",function(){return o.goToForgotPassword()}),e.EFF(31,"Forgot Password?"),e.k0s()(),e.j41(32,"ion-button",24),e.EFF(33," Login "),e.k0s(),e.j41(34,"div",25)(35,"ion-text"),e.EFF(36,"New user? "),e.j41(37,"a",26),e.bIt("click",function(){return o.goToRegister()}),e.EFF(38,"Create Account"),e.k0s()()()()()()()),2&r&&(e.Y8G("fullscreen",!0),e.R7$(19),e.R50("ngModel",o.phone),e.R7$(4),e.Y8G("type",o.showPassword?"text":"password"),e.R50("ngModel",o.password),e.R7$(),e.Y8G("ngIf",o.password||o.passwordFocused),e.R7$(3),e.R50("ngModel",o.rememberMe))},dependencies:[g.bv,g.Jm,g.eY,g.W9,g.iq,g.$w,g.uz,g.he,g.IO,g.hB,g.Gw,u.YN,u.qT,u.BC,u.cb,u.YS,u.tU,u.R_,u.vS,u.cV,p.MD,p.bT],styles:[".login-content[_ngcontent-%COMP%]{--background: #f0f4f8;position:relative;height:100%;font-family:Segoe UI,sans-serif;display:flex;justify-content:center;align-items:center;overflow:hidden;flex-direction:column;padding:env(safe-area-inset-top) 20px env(safe-area-inset-bottom);box-sizing:border-box}.login-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{text-align:center;font-size:28px;font-weight:700;margin:24px 0 12px}.login-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3b82f6;text-decoration:none}.login-content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}.background-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:url(/assets/bglogin.jpg) no-repeat center center/cover;filter:blur(6px);opacity:.3;z-index:0}.login-wrapper[_ngcontent-%COMP%]{z-index:1;width:100%;display:flex;justify-content:center;margin-top:5vh;padding:1rem}.login-container[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:2rem 1.5rem;max-width:400px;width:100%;box-shadow:0 10px 28px #00000026;animation:_ngcontent-%COMP%_fadeIn .6s ease-in-out;position:relative}.login-container.adjusted[_ngcontent-%COMP%]{padding:2.5rem 2rem;max-width:400px}.logo-circle[_ngcontent-%COMP%]{width:70px;height:70px;border-radius:50%;overflow:hidden;margin:0 auto 1rem;box-shadow:0 0 8px #0003}.logo-circle[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.logo-title[_ngcontent-%COMP%]{text-align:center;font-size:2rem;font-weight:700;color:#1e3a8a;margin-bottom:4px}.subtext[_ngcontent-%COMP%]{text-align:center;font-size:.95rem;color:#444;font-style:italic;margin-bottom:1rem}.divider[_ngcontent-%COMP%]{width:100%;height:1px;background-color:#ddd;margin-bottom:1.5rem}.phone-container[_ngcontent-%COMP%]{display:flex;gap:8px;width:100%;max-width:320px;margin-bottom:12px}.phone-container[_ngcontent-%COMP%]   .phone-box[_ngcontent-%COMP%]{--background: #fff;--border-radius: 8px;--border-color: #3e5b94;border:1px solid #3e5b94;height:48px;display:flex;align-items:center;padding-left:8px}.phone-container[_ngcontent-%COMP%]   .prefix-box[_ngcontent-%COMP%]{flex:0 0 80px;justify-content:center}.phone-container[_ngcontent-%COMP%]   .input-box[_ngcontent-%COMP%]{flex:1}.phone-container[_ngcontent-%COMP%]   .prefix-label[_ngcontent-%COMP%]{font-size:16px}.phone-container[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{font-size:16px;text-align:center;width:100%}ion-item.custom-input[_ngcontent-%COMP%]{--background: #f9f9f9;border-radius:8px;margin-bottom:1.2rem;height:55px;font-size:1rem;box-shadow:0 0 0 1px #ccc;transition:box-shadow .2s ease-in-out;--padding-end: 10px;--padding-start: 10px;width:100%;max-width:320px}.input-focused[_ngcontent-%COMP%]{box-shadow:0 0 0 2px #3b82f6!important}.input-focused[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#3b82f6!important;font-weight:600}.center-input[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], .center-text[_ngcontent-%COMP%]{text-align:center}.checkbox-forgot-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;font-size:14px;width:100%;max-width:320px;margin-bottom:12px}.checkbox-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.custom-checkbox[_ngcontent-%COMP%]{--checkbox-background-checked: #3e5b94;--border-color-checked: #3e5b94}.login-button[_ngcontent-%COMP%], .login-btn[_ngcontent-%COMP%]{--background: linear-gradient(to right, #3b82f6, #2563eb);--border-radius: 8px;color:#fff;font-weight:700;font-size:1rem;height:44px;width:100%;max-width:320px;margin-bottom:16px;box-shadow:0 4px 12px #3b82f64d}.bottom-text[_ngcontent-%COMP%]{margin-top:12px;text-align:center;font-size:14px}.create-link[_ngcontent-%COMP%]{color:#1e66c8;font-weight:600;text-decoration:underline;cursor:pointer}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}"]})}return i})()},1815:(P,h,a)=>{a.d(h,{f:()=>b});var d=a(467),g=a(1471),p=a(8728),e=a(3622),m=a(8880),f=a(8492);let b=(()=>{class _{constructor(n,i,c){this.sqlite=n,this.platform=i,this.storage=c,this.dbInstance=null,this.initDatabase()}initDatabase(){var n=this;return(0,d.A)(function*(){try{if(!n.platform.is("hybrid"))return void console.warn("Not running on hybrid platform \u2014 SQLite is not available.");const i=yield n.sqlite.create({name:"barangayconnect.db",location:"default"});n.dbInstance=i,yield i.executeSql("\n        CREATE TABLE IF NOT EXISTS users (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          firstName TEXT,\n          middleName TEXT,\n          lastName TEXT,\n          dob TEXT,\n          gender TEXT,\n          civilStatus TEXT,\n          contact TEXT UNIQUE,\n          purok TEXT,\n          barangay TEXT,\n          city TEXT,\n          province TEXT,\n          postalCode TEXT,\n          password TEXT,\n          photo TEXT,\n          role TEXT\n        )\n      ",[])}catch(i){console.error("SQLite init error:",i)}})()}saveOfflineRegistration(n){var i=this;return(0,d.A)(function*(){if(!i.dbInstance)return void console.error("Database is not initialized");const c=g.SHA256(n.password).toString(),r=[n.firstName,n.middleName,n.lastName,n.dob,n.gender,n.civilStatus,n.contact,n.purok,n.barangay,n.city,n.province,n.postalCode,c,n.photo,n.role||"resident"];console.log("\u{1f4e5} Attempting to insert into SQLite:",r);try{const o=yield i.dbInstance.executeSql("\n      INSERT INTO users (\n        firstName, middleName, lastName, dob, gender, civilStatus, contact, purok,\n        barangay, city, province, postalCode, password, photo, role\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ",r);console.log("\u2705 Insert result:",o),1===o.rowsAffected?console.log("\u2705 User inserted successfully."):console.warn("\u26a0\ufe0f Insert did not affect any rows.")}catch(o){console.error("\u274c Insert error:",o.message||o)}})()}getAllRegistrations(){var n=this;return(0,d.A)(function*(){if(!n.dbInstance)return console.warn("getAllRegistrations: Database not available."),[];const i=yield n.dbInstance.executeSql("SELECT * FROM users",[]),c=[];for(let t=0;t<i.rows.length;t++)c.push(i.rows.item(t));return c})()}isDuplicateContact(n){var i=this;return(0,d.A)(function*(){return i.dbInstance?(yield i.dbInstance.executeSql("SELECT * FROM users WHERE contact = ?",[n])).rows.length>0:(console.warn("isDuplicateContact: Database not available."),!1)})()}isDuplicateName(n,i,c){var t=this;return(0,d.A)(function*(){return t.dbInstance?(yield t.dbInstance.executeSql("SELECT * FROM users WHERE lower(firstName) = ? AND lower(middleName) = ? AND lower(lastName) = ?",[n.toLowerCase(),i.toLowerCase(),c.toLowerCase()])).rows.length>0:(console.warn("isDuplicateName: Database not available."),!1)})()}updateUser(n){var i=this;return(0,d.A)(function*(){if(!i.dbInstance)return void console.warn("updateUser: Database not available.");const t=[n.firstName,n.middleName,n.lastName,n.dob,n.gender,n.civilStatus,n.contact,n.purok,n.barangay,n.city,n.province,n.postalCode,n.password,n.photo,n.id];yield i.dbInstance.executeSql("\n      UPDATE users SET\n        firstName = ?, middleName = ?, lastName = ?, dob = ?, gender = ?, civilStatus = ?,\n        contact = ?, purok = ?, barangay = ?, city = ?, province = ?, postalCode = ?,\n        password = ?, photo = ?\n      WHERE id = ?\n    ",t)})()}checkLogin(n,i){var c=this;return(0,d.A)(function*(){const t=g.SHA256(i).toString();if(c.dbInstance)try{const s=yield c.dbInstance.executeSql("SELECT * FROM users WHERE contact = ? AND password = ?",[n,t]);if(s.rows.length>0)return s.rows.item(0)}catch(s){console.error("SQLite checkLogin error:",s)}else console.warn("SQLite not available. Using fallback storage.");const r=yield c.storage.get("secretary"),o=yield c.storage.get("captain");return r&&r.phone===n&&r.password===t?{...r,role:"secretary"}:o&&o.phone===n&&o.password===t?{...o,role:"captain"}:null})()}setCurrentUser(n){this.currentUser=n}getCurrentUser(){return this.currentUser}clearAll(){var n=this;return(0,d.A)(function*(){n.dbInstance?yield n.dbInstance.executeSql("DELETE FROM users",[]):console.warn("clearAll: Database not available.")})()}static#e=this.\u0275fac=function(i){return new(i||_)(p.KVO(e.j),p.KVO(m.OD),p.KVO(f.w))};static#n=this.\u0275prov=p.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()}}]);