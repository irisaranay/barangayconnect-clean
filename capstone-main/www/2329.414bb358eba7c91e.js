"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2329],{1815:(b,E,a)=>{a.d(E,{f:()=>f});var l=a(467),_=a(1471),d=a(8728),i=a(3622),o=a(8880),m=a(8492);let f=(()=>{class u{constructor(t,e,n){this.sqlite=t,this.platform=e,this.storage=n,this.dbInstance=null,this.initDatabase()}initDatabase(){var t=this;return(0,l.A)(function*(){try{if(!t.platform.is("hybrid"))return void console.warn("Not running on hybrid platform \u2014 SQLite is not available.");const e=yield t.sqlite.create({name:"barangayconnect.db",location:"default"});t.dbInstance=e,yield e.executeSql("\n        CREATE TABLE IF NOT EXISTS users (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          firstName TEXT,\n          middleName TEXT,\n          lastName TEXT,\n          dob TEXT,\n          gender TEXT,\n          civilStatus TEXT,\n          contact TEXT UNIQUE,\n          purok TEXT,\n          barangay TEXT,\n          city TEXT,\n          province TEXT,\n          postalCode TEXT,\n          password TEXT,\n          photo TEXT,\n          role TEXT\n        )\n      ",[])}catch(e){console.error("SQLite init error:",e)}})()}saveOfflineRegistration(t){var e=this;return(0,l.A)(function*(){if(!e.dbInstance)return void console.error("Database is not initialized");const n=_.SHA256(t.password).toString(),c=[t.firstName,t.middleName,t.lastName,t.dob,t.gender,t.civilStatus,t.contact,t.purok,t.barangay,t.city,t.province,t.postalCode,n,t.photo,t.role||"resident"];console.log("\u{1f4e5} Attempting to insert into SQLite:",c);try{const s=yield e.dbInstance.executeSql("\n      INSERT INTO users (\n        firstName, middleName, lastName, dob, gender, civilStatus, contact, purok,\n        barangay, city, province, postalCode, password, photo, role\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ",c);console.log("\u2705 Insert result:",s),1===s.rowsAffected?console.log("\u2705 User inserted successfully."):console.warn("\u26a0\ufe0f Insert did not affect any rows.")}catch(s){console.error("\u274c Insert error:",s.message||s)}})()}getAllRegistrations(){var t=this;return(0,l.A)(function*(){if(!t.dbInstance)return console.warn("getAllRegistrations: Database not available."),[];const e=yield t.dbInstance.executeSql("SELECT * FROM users",[]),n=[];for(let r=0;r<e.rows.length;r++)n.push(e.rows.item(r));return n})()}isDuplicateContact(t){var e=this;return(0,l.A)(function*(){return e.dbInstance?(yield e.dbInstance.executeSql("SELECT * FROM users WHERE contact = ?",[t])).rows.length>0:(console.warn("isDuplicateContact: Database not available."),!1)})()}isDuplicateName(t,e,n){var r=this;return(0,l.A)(function*(){return r.dbInstance?(yield r.dbInstance.executeSql("SELECT * FROM users WHERE lower(firstName) = ? AND lower(middleName) = ? AND lower(lastName) = ?",[t.toLowerCase(),e.toLowerCase(),n.toLowerCase()])).rows.length>0:(console.warn("isDuplicateName: Database not available."),!1)})()}updateUser(t){var e=this;return(0,l.A)(function*(){if(!e.dbInstance)return void console.warn("updateUser: Database not available.");const r=[t.firstName,t.middleName,t.lastName,t.dob,t.gender,t.civilStatus,t.contact,t.purok,t.barangay,t.city,t.province,t.postalCode,t.password,t.photo,t.id];yield e.dbInstance.executeSql("\n      UPDATE users SET\n        firstName = ?, middleName = ?, lastName = ?, dob = ?, gender = ?, civilStatus = ?,\n        contact = ?, purok = ?, barangay = ?, city = ?, province = ?, postalCode = ?,\n        password = ?, photo = ?\n      WHERE id = ?\n    ",r)})()}checkLogin(t,e){var n=this;return(0,l.A)(function*(){const r=_.SHA256(e).toString();if(n.dbInstance)try{const g=yield n.dbInstance.executeSql("SELECT * FROM users WHERE contact = ? AND password = ?",[t,r]);if(g.rows.length>0)return g.rows.item(0)}catch(g){console.error("SQLite checkLogin error:",g)}else console.warn("SQLite not available. Using fallback storage.");const c=yield n.storage.get("secretary"),s=yield n.storage.get("captain");return c&&c.phone===t&&c.password===r?{...c,role:"secretary"}:s&&s.phone===t&&s.password===r?{...s,role:"captain"}:null})()}setCurrentUser(t){this.currentUser=t}getCurrentUser(){return this.currentUser}clearAll(){var t=this;return(0,l.A)(function*(){t.dbInstance?yield t.dbInstance.executeSql("DELETE FROM users",[]):console.warn("clearAll: Database not available.")})()}static#t=this.\u0275fac=function(e){return new(e||u)(d.KVO(i.j),d.KVO(o.OD),d.KVO(m.w))};static#e=this.\u0275prov=d.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},2329:(b,E,a)=>{a.r(E),a.d(E,{ForgotPasswordPage:()=>u});var l=a(467),_=a(2200),p=a(4341),d=a(6908),i=a(9420),o=a(3664),m=a(7134),f=a(1815);let u=(()=>{class h{constructor(e,n){this.router=e,this.registrationService=n,this.phoneNumber=""}ngOnInit(){}sendCode(){var e=this;return(0,l.A)(function*(){const n=e.phoneNumber.startsWith("0")?"+63"+e.phoneNumber.slice(1):e.phoneNumber;/^(\+639)\d{9}$/.test(n)?(yield e.registrationService.isDuplicateContact(n))?(alert("\u2705 Code sent to "+n),e.router.navigate(["/verify-code"],{queryParams:{phone:n}})):alert("\u274c This phone number is not registered."):alert("\u274c Invalid phone number. Must be like 09123456789.")})()}goToLogin(){this.router.navigate(["/login"])}static#t=this.\u0275fac=function(n){return new(n||h)(o.rXU(m.Ix),o.rXU(f.f))};static#e=this.\u0275cmp=o.VBU({type:h,selectors:[["app-forgot-password"]],decls:17,vars:1,consts:[[1,"forgot-content","ion-padding"],[1,"forgot-container"],["type","tel","placeholder","Enter Phone Number (e.g. 09123456789)","inputmode","numeric","maxlength","11",3,"ngModelChange","ngModel"],["expand","block",3,"click"],[1,"go-back",2,"text-align","center","margin-top","10px"],[3,"click"]],template:function(n,r){1&n&&(o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o.EFF(3,"Forgot Password"),o.k0s()()(),o.j41(4,"ion-content",0)(5,"div",1)(6,"h2"),o.EFF(7,"Reset Your Password"),o.k0s(),o.j41(8,"ion-item")(9,"ion-input",2),o.mxI("ngModelChange",function(s){return o.DH7(r.phoneNumber,s)||(r.phoneNumber=s),s}),o.k0s()(),o.j41(10,"ion-button",3),o.bIt("click",function(){return r.sendCode()}),o.EFF(11,"Send Code"),o.k0s(),o.j41(12,"div",4)(13,"small"),o.EFF(14,"Go Back To? "),o.j41(15,"a",5),o.bIt("click",function(){return r.goToLogin()}),o.EFF(16,"Log In"),o.k0s()()()()()),2&n&&(o.R7$(9),o.R50("ngModel",r.phoneNumber))},dependencies:[_.MD,p.YN,p.BC,p.tU,p.vS,d.W9,d.Jm,d.$w,i.bv,i.Jm,i.W9,i.eU,i.$w,i.uz,i.BC,i.ai,i.Gw],styles:[".forgot-content[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:16px;background-color:#f5f7fa}.forgot-container[_ngcontent-%COMP%]{width:100%;max-width:400px;padding:20px;background:#fff;border-radius:12px;box-shadow:0 4px 12px #0000001a;box-sizing:border-box;margin:auto}.forgot-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:20px;font-size:24px;font-weight:600;color:#1c1c1e}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;margin-bottom:16px}ion-input[_ngcontent-%COMP%]{font-size:16px}.send-code-btn[_ngcontent-%COMP%]{margin-top:20px;--background: #3880ff;--border-radius: 8px;--color: #fff}.go-back[_ngcontent-%COMP%]{margin-top:15px;text-align:center}.go-back[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:14px}.go-back[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#3880ff;text-decoration:underline;cursor:pointer}"]})}return h})()}}]);