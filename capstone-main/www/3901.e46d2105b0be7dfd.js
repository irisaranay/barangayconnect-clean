"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3901],{1815:(y,M,l)=>{l.d(M,{f:()=>u});var m=l(467),s=l(1471),h=l(8728),C=l(3622),T=l(8880),e=l(8492);let u=(()=>{class P{constructor(o,r,c){this.sqlite=o,this.platform=r,this.storage=c,this.dbInstance=null,this.initDatabase()}initDatabase(){var o=this;return(0,m.A)(function*(){try{if(!o.platform.is("hybrid"))return void console.warn("Not running on hybrid platform \u2014 SQLite is not available.");const r=yield o.sqlite.create({name:"barangayconnect.db",location:"default"});o.dbInstance=r,yield r.executeSql("\n        CREATE TABLE IF NOT EXISTS users (\n          id INTEGER PRIMARY KEY AUTOINCREMENT,\n          firstName TEXT,\n          middleName TEXT,\n          lastName TEXT,\n          dob TEXT,\n          gender TEXT,\n          civilStatus TEXT,\n          contact TEXT UNIQUE,\n          purok TEXT,\n          barangay TEXT,\n          city TEXT,\n          province TEXT,\n          postalCode TEXT,\n          password TEXT,\n          photo TEXT,\n          role TEXT\n        )\n      ",[])}catch(r){console.error("SQLite init error:",r)}})()}saveOfflineRegistration(o){var r=this;return(0,m.A)(function*(){if(!r.dbInstance)return void console.error("Database is not initialized");const c=s.SHA256(o.password).toString(),p=[o.firstName,o.middleName,o.lastName,o.dob,o.gender,o.civilStatus,o.contact,o.purok,o.barangay,o.city,o.province,o.postalCode,c,o.photo,o.role||"resident"];console.log("\u{1f4e5} Attempting to insert into SQLite:",p);try{const f=yield r.dbInstance.executeSql("\n      INSERT INTO users (\n        firstName, middleName, lastName, dob, gender, civilStatus, contact, purok,\n        barangay, city, province, postalCode, password, photo, role\n      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    ",p);console.log("\u2705 Insert result:",f),1===f.rowsAffected?console.log("\u2705 User inserted successfully."):console.warn("\u26a0\ufe0f Insert did not affect any rows.")}catch(f){console.error("\u274c Insert error:",f.message||f)}})()}getAllRegistrations(){var o=this;return(0,m.A)(function*(){if(!o.dbInstance)return console.warn("getAllRegistrations: Database not available."),[];const r=yield o.dbInstance.executeSql("SELECT * FROM users",[]),c=[];for(let _=0;_<r.rows.length;_++)c.push(r.rows.item(_));return c})()}isDuplicateContact(o){var r=this;return(0,m.A)(function*(){return r.dbInstance?(yield r.dbInstance.executeSql("SELECT * FROM users WHERE contact = ?",[o])).rows.length>0:(console.warn("isDuplicateContact: Database not available."),!1)})()}isDuplicateName(o,r,c){var _=this;return(0,m.A)(function*(){return _.dbInstance?(yield _.dbInstance.executeSql("SELECT * FROM users WHERE lower(firstName) = ? AND lower(middleName) = ? AND lower(lastName) = ?",[o.toLowerCase(),r.toLowerCase(),c.toLowerCase()])).rows.length>0:(console.warn("isDuplicateName: Database not available."),!1)})()}updateUser(o){var r=this;return(0,m.A)(function*(){if(!r.dbInstance)return void console.warn("updateUser: Database not available.");const _=[o.firstName,o.middleName,o.lastName,o.dob,o.gender,o.civilStatus,o.contact,o.purok,o.barangay,o.city,o.province,o.postalCode,o.password,o.photo,o.id];yield r.dbInstance.executeSql("\n      UPDATE users SET\n        firstName = ?, middleName = ?, lastName = ?, dob = ?, gender = ?, civilStatus = ?,\n        contact = ?, purok = ?, barangay = ?, city = ?, province = ?, postalCode = ?,\n        password = ?, photo = ?\n      WHERE id = ?\n    ",_)})()}checkLogin(o,r){var c=this;return(0,m.A)(function*(){const _=s.SHA256(r).toString();if(c.dbInstance)try{const E=yield c.dbInstance.executeSql("SELECT * FROM users WHERE contact = ? AND password = ?",[o,_]);if(E.rows.length>0)return E.rows.item(0)}catch(E){console.error("SQLite checkLogin error:",E)}else console.warn("SQLite not available. Using fallback storage.");const p=yield c.storage.get("secretary"),f=yield c.storage.get("captain");return p&&p.phone===o&&p.password===_?{...p,role:"secretary"}:f&&f.phone===o&&f.password===_?{...f,role:"captain"}:null})()}setCurrentUser(o){this.currentUser=o}getCurrentUser(){return this.currentUser}clearAll(){var o=this;return(0,m.A)(function*(){o.dbInstance?yield o.dbInstance.executeSql("DELETE FROM users",[]):console.warn("clearAll: Database not available.")})()}static#e=this.\u0275fac=function(r){return new(r||P)(h.KVO(C.j),h.KVO(T.OD),h.KVO(e.w))};static#n=this.\u0275prov=h.jDH({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})()},3901:(y,M,l)=>{l.r(M),l.d(M,{ProfilePage:()=>D});var m=l(467),s=l(9420),b=l(2200),h=l(4341),C=l(1471),e=l(3664),u=l(8728),P=l(1815),I=l(8880);const o=()=>({"non-editable":!0}),r=d=>({"edit-gray":d}),c=d=>({"edit-blue":d});function _(d,w){if(1&d){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label",5),e.EFF(2,"New Password"),e.k0s(),e.j41(3,"ion-input",18),e.mxI("ngModelChange",function(n){u.eBV(t);const a=e.XpG();return e.DH7(a.newPassword,n)||(a.newPassword=n),u.Njj(n)}),e.j41(4,"ion-buttons",3)(5,"ion-button",19),e.bIt("click",function(){u.eBV(t);const n=e.XpG();return u.Njj(n.toggleNewPasswordVisibility())}),e.nrm(6,"ion-icon",20),e.k0s()()()()}if(2&d){const t=e.XpG();e.R7$(3),e.R50("ngModel",t.newPassword),e.Y8G("type",t.showNewPassword?"text":"password"),e.R7$(3),e.Y8G("name",t.showNewPassword?"eye-off":"eye")}}function p(d,w){if(1&d){const t=e.RV6();e.j41(0,"ion-item")(1,"ion-label",5),e.EFF(2,"Confirm Password"),e.k0s(),e.j41(3,"ion-input",18),e.mxI("ngModelChange",function(n){u.eBV(t);const a=e.XpG();return e.DH7(a.confirmPassword,n)||(a.confirmPassword=n),u.Njj(n)}),e.j41(4,"ion-buttons",3)(5,"ion-button",19),e.bIt("click",function(){u.eBV(t);const n=e.XpG();return u.Njj(n.toggleConfirmPasswordVisibility())}),e.nrm(6,"ion-icon",20),e.k0s()()()()}if(2&d){const t=e.XpG();e.R7$(3),e.R50("ngModel",t.confirmPassword),e.Y8G("type",t.showConfirmPassword?"text":"password"),e.R7$(3),e.Y8G("name",t.showConfirmPassword?"eye-off":"eye")}}function f(d,w){1&d&&(e.j41(0,"ion-text",21)(1,"p",22),e.EFF(2,"Passwords do not match."),e.k0s()())}function E(d,w){if(1&d){const t=e.RV6();e.j41(0,"div",23)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.EFF(4,"Edit Contact Number"),e.k0s()(),e.j41(5,"ion-card-content")(6,"ion-input",24),e.mxI("ngModelChange",function(n){u.eBV(t);const a=e.XpG();return e.DH7(a.user.contact,n)||(a.user.contact=n),u.Njj(n)}),e.k0s(),e.j41(7,"ion-button",25),e.bIt("click",function(){u.eBV(t);const n=e.XpG();return u.Njj(n.closeModal())}),e.EFF(8,"Save"),e.k0s()()()()}if(2&d){const t=e.XpG();e.R7$(6),e.R50("ngModel",t.user.contact)}}let D=(()=>{class d{constructor(t,g,n){this.registrationService=t,this.toastCtrl=g,this.navCtrl=n,this.user={},this.isEditing=!1,this.isContactModalOpen=!1,this.newPassword="",this.confirmPassword="",this.showNewPassword=!1,this.showConfirmPassword=!1}goBack(){this.navCtrl.back()}ionViewWillEnter(){this.user=this.registrationService.getCurrentUser()}toggleEdit(){var t=this;return(0,m.A)(function*(){if(t.isEditing){if(t.newPassword||t.confirmPassword){if(t.newPassword!==t.confirmPassword)return void t.presentToast("\u26a0\ufe0f Passwords do not match.","danger");t.user.password=C.SHA256(t.newPassword).toString()}yield t.registrationService.updateUser(t.user),t.presentToast("\u2705 Changes saved successfully.","success"),t.newPassword="",t.confirmPassword=""}t.isEditing=!t.isEditing})()}toggleNewPasswordVisibility(){this.showNewPassword=!this.showNewPassword}toggleConfirmPasswordVisibility(){this.showConfirmPassword=!this.showConfirmPassword}openContactModal(){this.isEditing&&(this.isContactModalOpen=!0)}closeModal(){this.isContactModalOpen=!1}updateContactNumber(t){this.user.contact=t,this.closeModal(),this.presentToast("\u{1f4f1} Contact number updated!","success")}presentToast(t,g){var n=this;return(0,m.A)(function*(){yield(yield n.toastCtrl.create({message:t,duration:2e3,position:"top",color:g})).present()})()}static#e=this.\u0275fac=function(g){return new(g||d)(e.rXU(P.f),e.rXU(s.K_),e.rXU(I.q9))};static#n=this.\u0275cmp=e.VBU({type:d,selectors:[["app-profile"]],decls:63,vars:34,consts:[["slot","start"],[3,"click"],["slot","icon-only","name","arrow-back"],["slot","end"],[1,"ion-padding"],["position","stacked"],["readonly","",3,"ngModelChange","ngModel","ngClass"],[3,"ngModelChange","ngModel","readonly","ngClass"],[3,"ngModelChange","ngModel","disabled"],["value","Male"],["value","Female"],["display-format","MMM DD, YYYY",3,"ngModelChange","ngModel","readonly"],[3,"click","button"],[3,"ngModelChange","ngModel","readonly"],["readonly","",3,"value"],[4,"ngIf"],["color","danger",4,"ngIf"],["class","contact-modal",4,"ngIf"],[3,"ngModelChange","ngModel","type"],["fill","clear",3,"click"],[3,"name"],["color","danger"],[1,"ion-padding-start"],[1,"contact-modal"],["type","tel",3,"ngModelChange","ngModel"],["expand","block",3,"click"]],template:function(g,n){1&g&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return n.goBack()}),e.nrm(4,"ion-icon",2),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Profile Information"),e.k0s(),e.j41(7,"ion-buttons",3)(8,"ion-button",1),e.bIt("click",function(){return n.toggleEdit()}),e.EFF(9),e.k0s()()()(),e.j41(10,"ion-content",4)(11,"ion-item")(12,"ion-label",5),e.EFF(13,"First Name"),e.k0s(),e.j41(14,"ion-input",6),e.mxI("ngModelChange",function(i){return e.DH7(n.user.firstName,i)||(n.user.firstName=i),i}),e.k0s()(),e.j41(15,"ion-item")(16,"ion-label",5),e.EFF(17,"Middle Name"),e.k0s(),e.j41(18,"ion-input",7),e.mxI("ngModelChange",function(i){return e.DH7(n.user.middleName,i)||(n.user.middleName=i),i}),e.k0s()(),e.j41(19,"ion-item")(20,"ion-label",5),e.EFF(21,"Last Name"),e.k0s(),e.j41(22,"ion-input",6),e.mxI("ngModelChange",function(i){return e.DH7(n.user.lastName,i)||(n.user.lastName=i),i}),e.k0s()(),e.j41(23,"ion-item")(24,"ion-label",5),e.EFF(25,"Gender"),e.k0s(),e.j41(26,"ion-select",8),e.mxI("ngModelChange",function(i){return e.DH7(n.user.gender,i)||(n.user.gender=i),i}),e.j41(27,"ion-select-option",9),e.EFF(28,"Male"),e.k0s(),e.j41(29,"ion-select-option",10),e.EFF(30,"Female"),e.k0s()()(),e.j41(31,"ion-item")(32,"ion-label",5),e.EFF(33,"Date of Birth"),e.k0s(),e.j41(34,"ion-datetime",11),e.mxI("ngModelChange",function(i){return e.DH7(n.user.dob,i)||(n.user.dob=i),i}),e.k0s()(),e.j41(35,"ion-item",12),e.bIt("click",function(){return n.isEditing&&n.openContactModal()}),e.j41(36,"ion-label",5),e.EFF(37,"Contact Number"),e.k0s(),e.j41(38,"ion-input",6),e.mxI("ngModelChange",function(i){return e.DH7(n.user.contact,i)||(n.user.contact=i),i}),e.k0s()(),e.j41(39,"ion-item")(40,"ion-label",5),e.EFF(41,"Purok"),e.k0s(),e.j41(42,"ion-input",13),e.mxI("ngModelChange",function(i){return e.DH7(n.user.purok,i)||(n.user.purok=i),i}),e.k0s()(),e.j41(43,"ion-item")(44,"ion-label",5),e.EFF(45,"Barangay"),e.k0s(),e.j41(46,"ion-input",13),e.mxI("ngModelChange",function(i){return e.DH7(n.user.barangay,i)||(n.user.barangay=i),i}),e.k0s()(),e.j41(47,"ion-item")(48,"ion-label",5),e.EFF(49,"City"),e.k0s(),e.j41(50,"ion-input",13),e.mxI("ngModelChange",function(i){return e.DH7(n.user.city,i)||(n.user.city=i),i}),e.k0s()(),e.j41(51,"ion-item")(52,"ion-label",5),e.EFF(53,"Province"),e.k0s(),e.j41(54,"ion-input",13),e.mxI("ngModelChange",function(i){return e.DH7(n.user.province,i)||(n.user.province=i),i}),e.k0s()(),e.j41(55,"ion-item")(56,"ion-label",5),e.EFF(57,"Password"),e.k0s(),e.nrm(58,"ion-input",14),e.k0s(),e.DNE(59,_,7,3,"ion-item",15)(60,p,7,3,"ion-item",15)(61,f,3,0,"ion-text",16),e.k0s(),e.DNE(62,E,9,1,"div",17)),2&g&&(e.R7$(9),e.SpI(" ",n.isEditing?"Save":"Edit"," "),e.R7$(5),e.R50("ngModel",n.user.firstName),e.Y8G("ngClass",e.lJ4(28,o)),e.R7$(4),e.R50("ngModel",n.user.middleName),e.Y8G("readonly",!n.isEditing)("ngClass",e.eq3(29,r,n.isEditing)),e.R7$(4),e.R50("ngModel",n.user.lastName),e.Y8G("ngClass",e.lJ4(31,o)),e.R7$(4),e.R50("ngModel",n.user.gender),e.Y8G("disabled",!n.isEditing),e.R7$(8),e.R50("ngModel",n.user.dob),e.Y8G("readonly",!n.isEditing),e.R7$(),e.Y8G("button",n.isEditing),e.R7$(3),e.R50("ngModel",n.user.contact),e.Y8G("ngClass",e.eq3(32,c,n.isEditing)),e.R7$(4),e.R50("ngModel",n.user.purok),e.Y8G("readonly",!n.isEditing),e.R7$(4),e.R50("ngModel",n.user.barangay),e.Y8G("readonly",!n.isEditing),e.R7$(4),e.R50("ngModel",n.user.city),e.Y8G("readonly",!n.isEditing),e.R7$(4),e.R50("ngModel",n.user.province),e.Y8G("readonly",!n.isEditing),e.R7$(4),e.Y8G("value","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"),e.R7$(),e.Y8G("ngIf",n.isEditing),e.R7$(),e.Y8G("ngIf",n.isEditing),e.R7$(),e.Y8G("ngIf",n.isEditing&&n.newPassword!==n.confirmPassword&&n.confirmPassword),e.R7$(),e.Y8G("ngIf",n.isContactModalOpen))},dependencies:[s.bv,s.Jm,s.QW,s.b_,s.I9,s.ME,s.tN,s.W9,s.A9,s.eU,s.iq,s.$w,s.uz,s.he,s.Nm,s.Ip,s.IO,s.BC,s.ai,s.Je,s.Gw,b.MD,b.YU,b.bT,h.YN,h.BC,h.vS],styles:["ion-item[_ngcontent-%COMP%]{--background: #f9f9f9;--padding-start: 12px;--inner-padding-end: 12px;--border-radius: 10px;--highlight-height: 0;margin-bottom:12px;box-shadow:0 1px 3px #0000000d;transition:background .3s}ion-label[_ngcontent-%COMP%]{font-weight:500;color:#444;font-size:14px}ion-input[_ngcontent-%COMP%]{font-size:15px;color:#000;transition:color .3s,border .3s;border-bottom:1px solid transparent}ion-input[readonly][_ngcontent-%COMP%]{color:#999;border-bottom:1px dashed #ccc}ion-input.editable[_ngcontent-%COMP%]{color:#007bff;border-bottom:1px solid #007bff}.contact-highlight[_ngcontent-%COMP%]{color:#28a745;font-weight:700}.edit-mode[_ngcontent-%COMP%]{background:#e8f4ff!important}ion-button[_ngcontent-%COMP%]{margin-top:20px}"]})}return d})()}}]);