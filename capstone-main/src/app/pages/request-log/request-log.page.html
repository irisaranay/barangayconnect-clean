<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Request Log</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <!-- Pagination and Search -->
  <div class="table-controls">
    <label>
      Show 
      <select [(ngModel)]="itemsPerPage" (change)="paginateRequests()">
        <option [value]="5">5</option>
        <option [value]="10">10</option>
        <option [value]="25">25</option>
      </select>
      entries
    </label>
    
    <input type="text" [(ngModel)]="searchTerm" (input)="filterRequests()" placeholder="Search...">
  </div>

  <ion-grid>
    <ion-row class="table-header">
      <ion-col size="1">#</ion-col>
      <ion-col size="3">Document</ion-col>
      <ion-col size="3">Date Requested</ion-col>
      <ion-col size="2">Status</ion-col>
      <ion-col size="3">Action</ion-col>
    </ion-row>

    <ion-row *ngFor="let request of paginatedRequests; let i = index">
      <ion-col size="1">{{ i + 1 + (currentPage - 1) * itemsPerPage }}</ion-col>
    <ion-col size="3">{{ request.documentType }}</ion-col>
     <ion-col size="3">{{ request.timestamp }}</ion-col>
      <ion-col size="2">
        <ion-text [color]="getStatusColor(request.status)">
          {{ request.status }}
        </ion-text>
      </ion-col>
      <ion-col size="3">
  <!-- Pending: can cancel -->
  <ion-button *ngIf="request.status === 'Pending'" color="danger" size="small" (click)="cancelRequest(request)">
    Cancel Request
  </ion-button>

  <!-- Approved / Rejected / For Pickup: show details -->
  <ion-button *ngIf="request.status !== 'Pending'" color="primary" size="small" (click)="viewDetails(request)">
    View Details
  </ion-button>

  <!-- Cancelled: can delete -->
  <ion-button *ngIf="request.status === 'Cancelled'" color="medium" size="small" (click)="deleteRequest(request)">
    Delete
  </ion-button>
</ion-col>
    </ion-row>
  </ion-grid>

  <!-- Pagination Controls -->
  <ion-row class="pagination-controls" *ngIf="totalPages > 1">
    <ion-button size="small" (click)="prevPage()" [disabled]="currentPage === 1">Prev</ion-button>
    <span>Page {{ currentPage }} of {{ totalPages }}</span>
    <ion-button size="small" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</ion-button>
  </ion-row>

</ion-content>

<ion-modal *ngIf="showModal">
  <ion-header>
    <ion-toolbar>
      <ion-title>Request Details</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="closeModal()">Close</ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-header>

  <ion-content class="ion-padding">
    <ion-card>
      <ion-card-header>
        <ion-card-title>{{ selectedRequest?.documentType }}</ion-card-title>
        <ion-card-subtitle>{{ selectedRequest?.status }}</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <p><strong>Purpose:</strong> {{ selectedRequest?.purpose }}</p>
        <p><strong>Copies:</strong> {{ selectedRequest?.copies }}</p>
        <p><strong>Requested On:</strong> {{ selectedRequest?.timestamp }}</p>

        <p *ngIf="selectedRequest?.status === 'Rejected'">
          <strong>Remarks:</strong> {{ selectedRequest?.notes || 'No remarks' }}
        </p>

        <div *ngIf="selectedRequest?.photo">
          <strong>Photo:</strong>
          <img [src]="selectedRequest.photo" style="width: 100%; margin-top: 10px;" />
        </div>
      </ion-card-content>
    </ion-card>
  </ion-content>
</ion-modal>

